/**
 * Description:
 * @author Seadon
 * @date 2016年2月23日
 *
 */

idefine(function(require, exports, module) {
	
	//首页加载显示
	jQuery.extend({PageLoading:function(a){function b(){if("complete"==document.readyState){var b=jQuery("#loadingPage");setTimeout(function(){jQuery("#loadingTips .loading-info").text("页面加载完成");jQuery(".modal-backdrop.in").fadeOut(1000).remove();b.animate({opacity:0},a.delayTime,function(){jQuery(this).hide()})},a.sleep)}}var c={opacity:1,borderColor:"#bbb",borderWidth:1,borderStyle:"solid",loadingTips:"努力加载中...",TipsColor:"#666",delayTime:1e3,zindex:9999,sleep:0},a=jQuery.extend(c,a),d=document.documentElement.clientHeight,e=document.documentElement.clientWidth,f='<div id="loadingPage" style="position:fixed;left:0;top:0;_position: absolute;width:100%;height:'+d+"px;background:"+a.backgroundColor+";opacity:"+a.opacity+";filter:alpha(opacity="+100*a.opacity+");z-index:"+a.zindex+';"><div id="loadingTips" style="position: absolute; cursor1: wait; width: auto;border-color:'+a.borderColor+";border-style:"+a.borderStyle+";border-width:"+a.borderWidth+"px; height:160px; line-height:100px; padding: 30px 20px;border-radius:10px; background:#fff; color:"+a.TipsColor+';font-size:20px;">'+'<div class="loadings">\n<span></span>\n<span></span>\n<span></span>\n<span></span>\n<span></span>\n</div><span class="loading-info">'+a.loadingTips+"</span></div></div><div class='modal-backdrop fade in'></div>";jQuery("body").append(f);var g=document.getElementById("loadingTips").clientHeight,h=document.getElementById("loadingTips").clientWidth,i=d>g?(d-g)/2:0,j=e>h?(e-h)/2:0;jQuery("#loadingTips").css({left:j+"px",top:i+"px"}),document.onreadystatechange=b}});
	
	//进度条
	!function(t){function s(){var t,s=document.createElement("fakeelement"),o={transition:"transitionend",OTransition:"oTransitionEnd",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"};for(t in o)if(void 0!==s.style[t])return o[t]}var o=s();t.ToProgress=function(t,s){if(this.progress=0,this.options={id:"i-progress-bar",color:"#F44336",height:"2px",duration:.3},t&&"object"==typeof t)for(var o in t)this.options[o]=t[o];if(this.options.opacityDuration=3*this.options.duration,this.progressBar=document.createElement("div"),this.progressBar.id=this.options.id,this.progressBar.setCSS=function(t){for(var s in t)this.style[s]=t[s]},this.progressBar.setCSS({position:s?"relative":"fixed",top:"0",left:"0",right:"0","box-shadow":"0 0 8px rgba(244,67,54,0.7)","z-index":"1003","background-color":this.options.color,height:this.options.height,width:"0%",transition:"width "+this.options.duration+"s, opacity "+this.options.opacityDuration+"s","-moz-transition":"width "+this.options.duration+"s, opacity "+this.options.opacityDuration+"s","-webkit-transition":"width "+this.options.duration+"s, opacity "+this.options.opacityDuration+"s"}),s){var i=document.querySelector(s);i&&(i.hasChildNodes()?i.insertBefore(this.progressBar,i.firstChild):i.appendChild(this.progressBar))}else document.body.appendChild(this.progressBar)},ToProgress.prototype.transit=function(){this.progressBar.style.width=this.progress+"%"},ToProgress.prototype.getProgress=function(){return this.progress},ToProgress.prototype.setProgress=function(t,s){this.show(),this.progress=t>100?100:0>t?0:t,this.transit(),s&&s()},ToProgress.prototype.increase=function(t,s){this.show(),this.setProgress(this.progress+t,s)},ToProgress.prototype.decrease=function(t,s){this.show(),this.setProgress(this.progress-t,s)},ToProgress.prototype.finish=function(t){var s=this;this.setProgress(100,t),this.hide(),o&&this.progressBar.addEventListener(o,function(t){s.reset(),s.progressBar.removeEventListener(t.type,arguments.callee)})},ToProgress.prototype.reset=function(t){this.progress=0,this.transit(),t&&t()},ToProgress.prototype.hide=function(){this.progressBar.style.opacity="0"},ToProgress.prototype.show=function(){this.progressBar.style.opacity="1"}}(window);

	//加载进度条初始化
	var pg=new ToProgress();function pgf(){pg.reset();var pgs=setInterval(function(){if(pg.getProgress()<89){pg.increase(1)}if(pg.getProgress()>=89){pg.increase(0.1)}if(pg.getProgress()==100){clearInterval(pgs);pg.finish()}},300);};window.i_web_pg=pg;
	
	//bootstrap-tab 动态处理
	!function($){$.fn.multabs=function(a){obj=$(this),Multab.options=$.extend({content:"",close:!0,monitor:"body",iframeUse:!0,iframeHeight:$(window).height()-107,method:"init",callback:function(){}},a||{}),$(Multab.options.monitor).on("click","[data-menu]",function(){obj.find('.i-close-tab').trigger('click'),Multab.add({id:$(this).attr("data-menu"),title:$(this).attr("title")?$(this).attr("title"):$(this).html().replace(/<b.*\/b>/g,""),banner:'<div class="i-frame-content"><div class="i-title-panel"><div class="i-title-name">'+$(this).attr("title")+'</div><div class="i-title-operate"><i class="i-close-tab glyphicon glyphicon-remove"></i></div></div><div class="i-frame-panel"></div></div>',content:Multab.options.content?Multab.options.content:$(this).attr("content"),url:$ctx+$(this).data("url"),ajax:$(this).attr("ajax")?!0:!1})}),obj.on("click",".i-close-tab",function(){var a=$(this).prev("a").attr("aria-controls");Multab.close(a)}),obj.on("mouseenter",".i-close-tab",function(){$(this).removeClass("glyphicon-remove").addClass("glyphicon-remove-circle")}),obj.on("mouseleave",".i-close-tab",function(){$(this).removeClass("glyphicon-remove-circle").addClass("glyphicon-remove")}),$(window).resize(function(){obj.find("iframe").attr("height",Multab.options.iframeHeight),Multab.drop()})}}(jQuery),function($){window.Multab={options:{},add:function(a){var b="tab_"+a.id;if(obj.find(".active").removeClass("active"),!$("#"+b)[0]){var c=$("<li>",{role:"presentation",id:"tab_"+b}).append($("<a>",{href:"#"+b,"aria-controls":b,role:"tab","data-toggle":"tab"}).html(a.title));Multab.options.close&&c.append($("<i>",{"class":"i-close-tab glyphicon glyphicon-remove"}));var d=$("<div>",{"class":"tab-pane i-tabs",id:b,role:"tabpanel"});a.content?d.append(a.content):Multab.options.iframeUse&&!a.ajax?(function(){pgf();d.append(a.banner);d.find(".i-frame-panel").css("width",$(window).width() - $('.i-menu-wrapper > .levelHolderClass').width() - 2).append($("<iframe>",{"class":"i-iframe",width:"100%",height:Multab.options.iframeHeight,frameborder:"no",border:"0",src:a.url}))})():$.get(a.url,function(a){d.append(a)}),obj.children(".nav-tabs").append(c),obj.children(".tab-content").append(d)}$('#i-aside-menu').css({'visibility':'visible','z-index':'1'}).fadeIn(1200),$("#i-body").fadeIn(1200),$("#i-nav-body").hide(),$("#i-content-body").show(),slideToggleProjects($('#i-desk-previews li'),-1,0,true),$("#tab_"+b).addClass("active"),$("#"+b).addClass("active"),$("#i-content-body").dragscrollable({dragSelector: ".tab-pane.active",preventDefault: false}),Multab.drop()},close:function(a){obj.find("li.active").attr("id")=="tab_"+a&&($("#tab_"+a).prev().addClass("active"),$("#"+a).prev().addClass("active")),$("#tab_"+a).remove(),$("#"+a).remove(),Multab.drop(),Multab.options.callback()},drop:function(){element=obj.find(".nav-tabs");var a=$("<li>",{"class":"dropdown pull-right hide tabdrop"}).append($("<a>",{"class":"dropdown-toggle","data-toggle":"dropdown",href:"#"}).append($("<i>",{"class":"glyphicon glyphicon-align-justify"})).append($("<b>",{"class":"caret"}))).append($("<ul>",{"class":"dropdown-menu"}));$(".tabdrop").html()?a=element.find(".tabdrop"):a.prependTo(element),element.parent().is(".tabs-below")&&a.addClass("dropup");var b=0;element.append(a.find("li")).find(">li").not(".tabdrop").each(function(){(this.offsetTop>0||element.width()-$(this).position().left-$(this).width()<53)&&(a.find("ul").append($(this)),b++)}),b>0?(a.removeClass("hide"),1==a.find(".active").length?a.addClass("active"):a.removeClass("active")):a.addClass("hide")}};}(jQuery);
	
	//首页桌面
	(function($){$.fn.bgLoaded=function(custom){var self=this;var defaults={afterLoaded:function(){this.addClass("bg-loaded")}};var settings=$.extend({},defaults,custom);self.each(function(){var $this=$(this),bgImgs=$this.css("background-image").split(", ");$this.data("loaded-count",0);$.each(bgImgs,function(key,value){var img=value.replace(/^url\(["']?/,"").replace(/["']?\)$/,"");$("<img/>").attr("src",img).load(function(){$(this).remove();$this.data("loaded-count",$this.data("loaded-count")+1);if($this.data("loaded-count")>=bgImgs.length){settings.afterLoaded.call($this)}})})})}})(jQuery);
	
	//jQuery dragscrollable
	(function($){$.fn.dragscrollable=function(options){var settings=$.extend({dragSelector:'>:first',acceptPropagatedEvent:true,preventDefault:true},options||{});var dragscroll={mouseDownHandler:function(event){if(event.which!=1||(!event.data.acceptPropagatedEvent&&event.target!=this)){return false;} event.data.lastCoord={left:event.clientX,top:event.clientY};$.event.add(document,"mouseup",dragscroll.mouseUpHandler,event.data);$.event.add(document,"mousemove",dragscroll.mouseMoveHandler,event.data);if(event.data.preventDefault){event.preventDefault();return false;}},mouseMoveHandler:function(event){var delta={left:(event.clientX-event.data.lastCoord.left),top:(event.clientY-event.data.lastCoord.top)};event.data.scrollable.scrollLeft(event.data.scrollable.scrollLeft()-delta.left);event.data.scrollable.scrollTop(event.data.scrollable.scrollTop()-delta.top);event.data.lastCoord={left:event.clientX,top:event.clientY}
	if(event.data.preventDefault){event.preventDefault();return false;}},mouseUpHandler:function(event){$.event.remove(document,"mousemove",dragscroll.mouseMoveHandler);$.event.remove(document,"mouseup",dragscroll.mouseUpHandler);if(event.data.preventDefault){event.preventDefault();return false;}}}
	this.each(function(){var data={scrollable:$(this),acceptPropagatedEvent:settings.acceptPropagatedEvent,preventDefault:settings.preventDefault}
	$(this).find(settings.dragSelector).bind('mousedown',data,dragscroll.mouseDownHandler);});};})(jQuery);
});